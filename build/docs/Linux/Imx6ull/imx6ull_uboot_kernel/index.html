<!doctype html>
<html lang="ljyws" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Linux/Imx6ull/imx6ull_uboot_kernel/Imx6ull_uboot_kernel" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">u-boot &amp; kernel | Hello!</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ljyws.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ljyws.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ljyws.com/docs/Linux/Imx6ull/imx6ull_uboot_kernel/"><meta data-rh="true" property="og:locale" content="ljyws"><meta data-rh="true" name="docusaurus_locale" content="ljyws"><meta data-rh="true" name="docsearch:language" content="ljyws"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="u-boot &amp; kernel | Hello!"><meta data-rh="true" name="description" content="从零开始编译u-boot与内核"><meta data-rh="true" property="og:description" content="从零开始编译u-boot与内核"><link data-rh="true" rel="icon" href="/img/sheep.ico"><link data-rh="true" rel="canonical" href="https://ljyws.com/docs/Linux/Imx6ull/imx6ull_uboot_kernel/"><link data-rh="true" rel="alternate" href="https://ljyws.com/docs/Linux/Imx6ull/imx6ull_uboot_kernel/" hreflang="ljyws"><link data-rh="true" rel="alternate" href="https://ljyws.com/docs/Linux/Imx6ull/imx6ull_uboot_kernel/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script src="src/custom-script.js" async></script><link rel="stylesheet" href="/assets/css/styles.0ace63c3.css">
<script src="/assets/js/runtime~main.d79da8d8.js" defer="defer"></script>
<script src="/assets/js/main.d8209316.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_vL3y" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/home_logo.svg" alt="My Site Logo" class="themedComponent_yNzQ themedComponent--light_XB7g"><img src="/img/home_logo.svg" alt="My Site Logo" class="themedComponent_yNzQ themedComponent--dark_Ih68"></div><b class="navbar__title text--truncate">HOME</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">BLOG</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ljyws" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_vnGv"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_p3ST"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_nWpo"><div class="docsWrapper_S7Ws"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_ILib" type="button"></button><div class="docRoot_y1tR"><aside class="theme-doc-sidebar-container docSidebarContainer_Nn1g"><div class="sidebarViewport_GazN"><div class="sidebar_ys6v"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_FFtM"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">主页</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/ProgrammingTips/finite-state machine/fsm">ProgrammingTips</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/StepperCtrl/simulation">StepperFocCtrl</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/FocController/foc_controller">FocController</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/quadruped-sim/eigen/">Quadruped-sim</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/Linux/Imx6ull/imx6ull_uboot_kernel/">Linux</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/Linux/Imx6ull/imx6ull_uboot_kernel/">Imx6ull</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Linux/Imx6ull/imx6ull_uboot_kernel/">u-boot &amp; kernel</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/irq/">Linux IRQ</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_DINd"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_uqYz"><div class="docItemContainer_i0hV"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_tQkO" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zh8J"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Linux</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Imx6ull</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">u-boot &amp; kernel</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_yfiv theme-doc-toc-mobile tocMobile_gZBm"><button type="button" class="clean-btn tocCollapsibleButton_ntcz">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>u-boot &amp; kernel</h1></header><h2 class="anchor anchorWithStickyNavbar_WC8U" id="从零开始编译u-boot与内核">从零开始编译u-boot与内核<a href="#从零开始编译u-boot与内核" class="hash-link" aria-label="Direct link to 从零开始编译u-boot与内核" title="Direct link to 从零开始编译u-boot与内核">​</a></h2>
<ul>
<li>硬件：正点原子阿尔法开发板（Imx6ull-emmc）</li>
<li>开发环境：ubuntu22.04</li>
<li>交叉编译工具：arm-linux-gnueabihf-</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_WC8U" id="u-boot">U-Boot<a href="#u-boot" class="hash-link" aria-label="Direct link to U-Boot" title="Direct link to U-Boot">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_WC8U" id="nxp-官方u-boot编译">NXP 官方u-boot编译<a href="#nxp-官方u-boot编译" class="hash-link" aria-label="Direct link to NXP 官方u-boot编译" title="Direct link to NXP 官方u-boot编译">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="1-安装ncurses库">1. 安装ncurses库<a href="#1-安装ncurses库" class="hash-link" aria-label="Direct link to 1. 安装ncurses库" title="Direct link to 1. 安装ncurses库">​</a></h4>
<p><code>sudo apt-get install libncurses5-dev</code></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="2-获取u-boot">2. 获取u-boot<a href="#2-获取u-boot" class="hash-link" aria-label="Direct link to 2. 获取u-boot" title="Direct link to 2. 获取u-boot">​</a></h4>
<p>一般来说我们获得u-boot有三种途径分别是：</p>
<ul>
<li>
<p>u-boot官方源码：uboot是一个遵循着GPL协议的开源软件，原汁原味，但是一般不推荐，因为其支持较少，如果需要，可以在以下链接下载：
<a href="https://ftp.denx.de/pub/u-boot/" target="_blank" rel="noopener noreferrer">u-boot源码</a></p>
</li>
<li>
<p>芯片  原厂提供：如瑞芯微、NXP、全志等芯片原厂会在u-boot源码基础上增加对自家芯片的支持，我们可以使用厂商提供的u-boot</p>
</li>
<li>
<p>第三方商家：由第三方商家制作开发板或板卡，会在厂商的基础上进一步增加对自己板卡的支持，使用更加方便</p>
</li>
</ul>
<p>由于是以学习为目的，这里使用第二种方式，使用NXP公司提供的u-boot源码进行编译移植</p>
<p>这里通过原子提供的<a href="https://pan.baidu.com/s/14W3WEpzOr_rNLyWaHOthHw?pwd=69ap" target="_blank" rel="noopener noreferrer">NXP官方u-boot</a>来进行移植和学习</p>
<p>将文件移动到ubuntu下，并解压缩：
<code>tar -vxjf uboot-imx-rel_imx_4.1.15_2.1.0_ga.tar.bz2</code></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="3-编译官方开发板的uboot">3. 编译官方开发板的uboot<a href="#3-编译官方开发板的uboot" class="hash-link" aria-label="Direct link to 3. 编译官方开发板的uboot" title="Direct link to 3. 编译官方开发板的uboot">​</a></h4>
<p>在uboot文件夹下的config文件里中，可以找到IMX6ULL EVK开发板对应的配置文件，也就是<img decoding="async" loading="lazy" src="/assets/images/1-a7a5a491c75c0162bbcc98a2f8891d7f.png" title="EVK开发板默认配置文件" width="1130" height="688" class="img_PzW8"></p>
<p>设置编译命令：<br>
<code>make ARCH=arm CROSS_PILE=arm-linux-gnueabihf- mx6ull_14x14_evk_emmc_defconfig </code></p>
<p>编译：<br>
<code>make V=1 ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-</code></p>
<p>可以看到编译成功：
<img decoding="async" loading="lazy" src="/assets/images/2-1123bb5d0ff7c2a3a3309f1db3eb0dad.png" title="官方开发板编译uboot" width="1061" height="672" class="img_PzW8"></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="4-烧录uboot">4. 烧录uboot<a href="#4-烧录uboot" class="hash-link" aria-label="Direct link to 4. 烧录uboot" title="Direct link to 4. 烧录uboot">​</a></h4>
<ol>
<li>
<p>从原子资料中  获取imx烧写工具imxdownload，并将其放置到文件夹中(我这里把工具类都放到了一个新建文件夹为tools里)</p>
</li>
<li>
<p>使用工具下载u-boot.bin文件到sd卡中：(这里我的u盘是sdb，要查看自己的，不一定是这个设备)</p>
</li>
</ol>
<p><code> ./imxdownload  ../uboot/u-boot.bin /dev/sdb</code></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="5-启动设备">5. 启动设备<a href="#5-启动设备" class="hash-link" aria-label="Direct link to 5. 启动设备" title="Direct link to 5. 启动设备">​</a></h4>
<ol>
<li>插上sd卡</li>
<li>将拨码拨到sd卡启动</li>
<li>打开串口工具，我这里使用的是mobaxterm，可以看到u-boot输出内容
<img decoding="async" loading="lazy" src="/assets/images/3-3f31e53da954315e8e3c772baa489154.png" title="uboot输出信息" width="1256" height="795" class="img_PzW8"></li>
</ol>
<p>说明了官方开发板的uboot编译成功。</p>
<h3 class="anchor anchorWithStickyNavbar_WC8U" id="移植自己的u-boot">移植自己的u-boot<a href="#移植自己的u-boot" class="hash-link" aria-label="Direct link to 移植自己的u-boot" title="Direct link to 移植自己的u-boot">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="1-增加自己配置文件">1. 增加自己配置文件<a href="#1-增加自己配置文件" class="hash-link" aria-label="Direct link to 1. 增加自己配置文件" title="Direct link to 1. 增加自己配置文件">​</a></h4>
<p>首先，在uboot文件夹下的config里，复制刚刚的mx6ull_14x14_evk_emmc_defconfig,并重命名一下<br>
<code>cp mx6ull_14x14_evk_emmc_defconfig mx6ull_keys_emmc_defconfig</code></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="2-修改自己的配置文件打开mx6ull_keys_emmc_defconfig">2. 修改自己的配置文件，打开mx6ull_keys_emmc_defconfig<a href="#2-修改自己的配置文件打开mx6ull_keys_emmc_defconfig" class="hash-link" aria-label="Direct link to 2. 修改自己的配置文件，打开mx6ull_keys_emmc_defconfig" title="Direct link to 2. 修改自己的配置文件，打开mx6ull_keys_emmc_defconfig">​</a></h4>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_SYS_EXTRA_OPTIONS=&quot;IMX_CONFIG=board/freescale/mx6ull_keys_emmc/imximage.cfg,MX6ULL_EVK_EMMC_REWORK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_ARM=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_ARCH_MX6=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_TARGET_MX6ULL_KEYS_EMMC=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_CMD_GPIO=y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>主要关注第一行和第四行的修改内容</em></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="3-增加自己板子的头文件">3. 增加自己板子的头文件<a href="#3-增加自己板子的头文件" class="hash-link" aria-label="Direct link to 3. 增加自己板子的头文件" title="Direct link to 3. 增加自己板子的头文件">​</a></h4>
<p>位于uboot文件夹中include中的configs文件夹下，注意还有一个config文件夹，是configs文件夹下</p>
<p><code>cd include/configs</code></p>
<p>复制mx6ullevk.h文件，并重命名一下，改成自己的头文件<br>
<code>cp mx6ullevk.h mx6ull_keys_emmc.h</code></p>
<p>打开文件，修改一下宏</p>
<p><code>gedit mx6ull_keys_emmc.h</code></p>
<p>将如下</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">#ifndef __MX6ULLEVK_CONFIG_H</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define __MX6ULLEVK_CONFIG_H</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>改为</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">#ifndef __MX6ULL_KEYS_EMMC_CONFIG_H__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define __MX6ULL_KEYS_EMMC_CONFIG_H__</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个文件主要是用于配置很多uboot的，所以可以看到里面有大量的#define宏定义，我们可以通过修改这里的配置来修改uboot
<img decoding="async" loading="lazy" src="/assets/images/4-d483c03f2d3710925f523599a5436077.png" title="头文件信息" width="1580" height="825" class="img_PzW8"></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="4-添加板级文件夹">4. 添加板级文件夹<a href="#4-添加板级文件夹" class="hash-link" aria-label="Direct link to 4. 添加板级文件夹" title="Direct link to 4. 添加板级文件夹">​</a></h4>
<p>uboot中每个板子都会有一个对应的文件夹来存放板级文件，例如一些外设驱动，NXP的I.MX系列芯片都位于board/freescale文件夹里，可以看到EVK板子是这个文件夹</p>
<p><img decoding="async" loading="lazy" src="/assets/images/5-412b25636b3909a65f89fd4ed33e7700.png" title="头文件信息" width="1383" height="733" class="img_PzW8"></p>
<p>我们需要复制这个文件夹，用于存放我们自己的文件</p>
<p><code>cd board/freescale/</code></p>
<p><code>cp mx6ullevk/ -r mx6ull_keys_emmc</code></p>
<p>进入文件夹，重命名mx6ulleck.c文件为mx6ull_keys_emmc.c<br>
<code>mv mx6ullevk.c mx6ull_keys_emmc.c</code></p>
<p>进入文件夹后，可以看到里面已经有一些编译后的.o文件了，我们需要修改一下编译规则<br>
<code>gedit Makefile</code></p>
<p>重点关注obj-y  := xxxxxxx.o</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain"># (C) Copyright 2015 Freescale Semiconductor, Inc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SPDX-License-Identifier:	GPL-2.0+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj-y  := mx6ull_keys_emmc.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extra-$(CONFIG_USE_PLUGIN) :=  plugin.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$(obj)/plugin.bin: $(obj)/plugin.o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$(OBJCOPY) -O binary --gap-fill 0xff $&lt; $@</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>继续修改imximage.cfg,将第34行改为：
<code>PLUGIN	board/freescale/mx6ull_keys_emmc/plugin.bin 0x00907000 </code></p>
<p>继续修改Kconfig文件,其实就是把各种mx6ullevk改为自己的，我这里就都是mx6ull_keys_emmc了</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">if TARGET_MX6ULL_KEYS_EMMC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config SYS_BOARD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	default &quot;mx6ull_keys_emmc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config SYS_VENDOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	default &quot;freescale&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config SYS_SOC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	default &quot;mx6&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config SYS_CONFIG_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	default &quot;mx6ull_keys_emmc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>继续，修改MAINTAINERS为</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">MX6ULL_KEYS_EMMC BOARD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">M:	Peng Fan &lt;peng.fan@nxp.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S:	Maintained</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F:	board/freescale/mx6ull_keys_emmc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F:	include/configs/mx6ull_keys_emmc.h</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="5-修改uboot的图形界面配置文件">5. 修改uboot的图形界面配置文件<a href="#5-修改uboot的图形界面配置文件" class="hash-link" aria-label="Direct link to 5. 修改uboot的图形界面配置文件" title="Direct link to 5. 修改uboot的图形界面配置文件">​</a></h4>
<p>进入文件夹，/uboot/arch/arm/cpu/armv7/mx6/
<code>gedit arch/arm/cpu/armv7/mx6</code></p>
<p>在207行增加：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">config TARGET_MX6ULL_KEYS_EMMC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	bool &quot;Support mx6ull_keys_emmc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	select MX6ULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	select DM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	select DM_THERMAL</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/6-ab5d36ab1eea7fccee836f533063848e.png" width="494" height="129" class="img_PzW8"></p>
<p>并在最后#endif之前增加：</p>
<p><code>source &quot;board/freescale/mx6ull_keys_emmc/Kconfig&quot;</code>
<img decoding="async" loading="lazy" src="/assets/images/7-78c9ab221c4c5a2176e3a4fe49869137.png" width="834" height="220" class="img_PzW8"></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="6-编译u-boot">6. 编译u-boot<a href="#6-编译u-boot" class="hash-link" aria-label="Direct link to 6. 编译u-boot" title="Direct link to 6. 编译u-boot">​</a></h4>
<ol>
<li>依次执行：</li>
</ol>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_keys_emmc_defconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make V=1 CROSS_COMPILE=arm-linux-gnueabihf- -j16</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="7-修改lcd配置">7. 修改LCD配置<a href="#7-修改lcd配置" class="hash-link" aria-label="Direct link to 7. 修改LCD配置" title="Direct link to 7. 修改LCD配置">​</a></h4>
<ol>
<li>打开mx6ull_keys_emmc.c文件，里面有一个结构体：</li>
</ol>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">struct display_info_t const displays[] = {{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.bus = MX6UL_LCDIF1_BASE_ADDR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.addr = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.pixfmt = 24,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.detect = NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.enable	= do_enable_parallel_lcd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.mode	= {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.name			= &quot;TFT43AB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.xres           = 480,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.yres           = 272,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.pixclock       = 108695,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.left_margin    = 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.right_margin   = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.upper_margin   = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.lower_margin   = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.hsync_len      = 41,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.vsync_len      = 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.sync           = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.vmode          = FB_VMODE_NONINTERLACED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} } };</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里就是LCD的配置信息了，这里我用的原子的7寸屏，也就是像素不一样，所以我的配置结构体改成了：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">struct display_info_t const displays[] = {{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.bus = MX6UL_LCDIF1_BASE_ADDR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.addr = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.pixfmt = 24,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.detect = NULL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.enable	= do_enable_parallel_lcd,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.mode	= {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.name			= &quot;TFT7016&quot;,                //LCD名字，要和环境变量里的panel相等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.xres           = 1024,                     //X轴像素数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.yres           = 600,                      //Y轴像素数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.pixclock       = 19531,		            //像素时钟，每个像素时钟周期的长度，单位为皮秒，原子用的时钟是51.2Mhz，就是19531皮秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.left_margin    = 140,                      //HBP水平同步后肩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.right_margin   = 160,                      //HFP水平同步前肩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.upper_margin   = V=20,                     //VBP垂直同步后见</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.lower_margin   = 12,                       //VFP垂直同步前肩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.hsync_len      = 20,                       //HSPW行同步脉宽</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.vsync_len      = 3,                        //VSPW垂直同步脉宽</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.sync           = 0,                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		.vmode          = FB_VMODE_NONINTERLACED    //不使用隔行扫描</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} } };</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>
<p>刚刚有一个LCD名字，要与uboot的panel相同，因此，打开mx6ull_keys_emmc.h，找到panel,修改：
<img decoding="async" loading="lazy" src="/assets/images/8-9f09c3aed27cf313de0475776b523862.png" width="517" height="194" class="img_PzW8"></p>
</li>
<li>
<p>重新编译uboot并烧录</p>
</li>
</ol>
<p>看到uboot的输出里，panel信息还是没有更新，是因为uboot会先从emmc里找环境变量，所以，我们手动设置一下：</p>
<p><code>setenv panel TFT7016</code></p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="436" height="133" class="img_PzW8"></p>
<ol start="4">
<li>重启
可以看到点亮了屏幕 显示出了NXP的图标</li>
</ol>
<p><img decoding="async" loading="lazy" src="/assets/images/10-ced18cd83c646f26cac29b5bf94defa6.png" width="4032" height="3024" class="img_PzW8"></p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="8-修改网络配置">8. 修改网络配置<a href="#8-修改网络配置" class="hash-link" aria-label="Direct link to 8. 修改网络配置" title="Direct link to 8. 修改网络配置">​</a></h4>
<p>官方的EVK开发板使用的是KSZ8081的PHY芯片，正点使用的是LAN8720A这颗PHY芯片，因此需要对uboot中网络配置进行修改</p>
<p>Imx6ull具有两个网络接口，ENET1和ENET2</p>
<ol>
<li>PHY芯片地址修改
首先对PHY地址进行修改，打开mx6ull_keys_emmc.h文件，主要进行如下修改：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/assets/images/11-3b4f28e4b4803f2f0a1bf7732df02999.png" width="666" height="321" class="img_PzW8"></p>
<ul>
<li>335行，将FEC_ENET1的网络PHY地址改为0x0</li>
<li>339行，将FEC_ENET2的网络PHY地址改为0x1</li>
<li>345行，将原先的MICREL公司名称改为SMSC（LAN8720芯片由SMSC生产，而之前的KSZ8081由MICREL公司生产）</li>
</ul>
<ol start="2">
<li>对网络复位引脚的驱动进行修改
打开mx6ull_keys_emmc.c文件，找到如下几行：</li>
</ol>
<p><img decoding="async" loading="lazy" src="/assets/images/12-fada45daa2bff7e077c2e864bc7d04cf.png" width="448" height="111" class="img_PzW8"></p>
<p>因为NXP的EVK开发板是使用74LV595对IO进行扩展控制的，而原子的板子并没有使用，因此删去这几行，并改写：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">#define ENET1_RESET_IMX_GPIO_NR(5,7)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define ENET2_RESET_IMX_GPIO_NR(5,8)</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于ENET1的复位引脚连在SNVS_TAMPER7也就是GPIO5_IO07,ENET2同理，所以改为如下：</p>
<p><img decoding="async" loading="lazy" src="/assets/images/13-641756820f873beb6d678eb1dda2c2dc.png" width="463" height="172" class="img_PzW8"></p>
<ol start="3">
<li>
<p>删除/注释关于74lv595相关代码</p>
<p>a. 找到如下代码并删除/注释：
<img decoding="async" loading="lazy" src="/assets/images/14-a0bad2a9835ae1664350cc36faa3cf7a.png" width="654" height="216" class="img_PzW8"></p>
<p>b. 找到static void iox74lv_init(void)与void iox74lv_set(int index)两个函数，全部删除/注释</p>
<p>c. 找到int board_init(void)函数，在该函数中，会通过<br>
<code>imx_iomux_v3_setup_multiple_pads</code>  与 <code>iox74lv_init()</code>来初始化74lv595的IO控制，因此要将这两行代码删除/注释</p>
</li>
<li>
<p>添加LAN8720A的复位引脚驱动
在mx6ull_keys_emmc.c文件里，由fec1_pads[]和fec2_pads[]来对ENET1和ENET2的IO进行配置，因此，要在这里添加相应的配置参数：</p>
</li>
</ol>
<p>在fec1_pads[]最后添加：<br>
<code>MX6_PAD_SNVS_TAMPER7__GPIO5_IO07 | MUX_PAD_CTRL(NO_PAD_CTRL),</code>
在fec2_pads[]最后添加：<br>
<code>MX6_PAD_SNVS_TAMPER7__GPIO5_IO08 | MUX_PAD_CTRL(NO_PAD_CTRL),</code></p>
<p>继续在文件中查找setup_iomux_fec函数，修改为 ：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">static void setup_iomux_fec(int fec_id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if (fec_id == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		imx_iomux_v3_setup_multiple_pads(fec1_pads,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						 ARRAY_SIZE(fec1_pads));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_direction_output(ENET1_RESET, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_set_value(ENET1_RESET, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mdelay(20);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_set_value(ENET1_RESET, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		imx_iomux_v3_setup_multiple_pads(fec2_pads,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">						 ARRAY_SIZE(fec2_pads));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_direction_output(ENET2_RESET, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_set_value(ENET2_RESET, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mdelay(20);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		gpio_set_value(ENET2_RESET, 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>修改驱动文件
进入drivers/net/phy/phy.c文件，原版的uboot对LAN8720A芯片驱动有问题，需要找到genphy_update_link函数，该函数是通用的phy驱动函数，因此需要修改为：<br>
<img decoding="async" loading="lazy" src="/assets/images/15-e4dad9966038cc1c2a8fb43331b7a062.png" width="760" height="438" class="img_PzW8"></li>
</ol>
<p>主要是在开头加入了下面这段：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef CONFIG_PHY_SMSC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	static int lan8720_flag = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int bmcr_reg = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if(lan8720_flag == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		bmcr_reg = phy_read(phydev, MDIO_DEVAD_NONE, MII_BMCR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		phy_write(phydev, MDIO_DEVAD_NONE,MII_BMCR, BMCR_RESET);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		while(phy_read(phydev, MDIO_DEVAD_NONE, MII_BMCR) &amp; 0X8000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			udelay(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		phy_write(phydev, MDIO_DEVAD_NONE, MII_BMCR, bmcr_reg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		lan8720_flag = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>重新编译uboot并烧录
可以看到网络已经配置好了：
<img decoding="async" loading="lazy" src="/assets/images/16-dbcc594650385c65a1106262ed8cdfbf.png" width="1005" height="795" class="img_PzW8"></li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_WC8U" id="结束-uboot移植">结束 uboot移植<a href="#结束-uboot移植" class="hash-link" aria-label="Direct link to 结束 uboot移植" title="Direct link to 结束 uboot移植">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_WC8U" id="kernel">kernel<a href="#kernel" class="hash-link" aria-label="Direct link to kernel" title="Direct link to kernel">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_WC8U" id="nxp-官方kernel编译">NXP 官方kernel编译<a href="#nxp-官方kernel编译" class="hash-link" aria-label="Direct link to NXP 官方kernel编译" title="Direct link to NXP 官方kernel编译">​</a></h3>
<p>这里直接使用原子提供的NXP官方内核文件，打开顶层的Makefile文件，可以找到如下：
<img decoding="async" loading="lazy" src="/assets/images/17-5a9f73b8bea0cbc7c814d45ef5af8766.png" width="922" height="220" class="img_PzW8"></p>
<p>这里可以直接对ARCH和CROSS_COMPILE进行修改，后期就不需要每次手敲了，写为自己的交叉编译工具：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">ARCH		?= $arm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CROSS_COMPILE	?= arm-linux-gnueabihf-</span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>保存，执行：</p>
<div class="codeBlockContainer_v3UO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ycsX"><pre tabindex="0" class="prism-code language-text codeBlock_eS68 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hVnV"><span class="token-line" style="color:#393A34"><span class="token plain">make clean </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make imx_v7_mfg_defconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make </span><br></span></code></pre><div class="buttonGroup_tWxT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_isEe" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_vCuH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon__Hal"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里我会报一个错误：<br>
<code>multiple definition of &#x27;yylloc&#x27;; scripts/dtc/dtc-lexer.lex.o:(.bss+0x0): first defined here </code></p>
<p>网上有一些说是GCC版本过高，不过可以去找一下这个变量，是在这个位置
<img decoding="async" loading="lazy" alt="alt text" src="/assets/images/18-59fb0a5ecf2a8cf2858112200a47324e.png" width="1281" height="680" class="img_PzW8"><br>
<!-- -->在变量的前面extern一下。</p>
<p>可以看到编译成功，生成了ZImage镜像文件，以及一大堆的设备树dtb文件
<img decoding="async" loading="lazy" alt="alt text" src="/assets/images/19-f7a5c05d6d2089edd7973e8cac406f74.png" width="680" height="598" class="img_PzW8"></p>
<h3 class="anchor anchorWithStickyNavbar_WC8U" id="配置自己的kernel">配置自己的kernel<a href="#配置自己的kernel" class="hash-link" aria-label="Direct link to 配置自己的kernel" title="Direct link to 配置自己的kernel">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="1-复制配置文件">1. 复制配置文件<a href="#1-复制配置文件" class="hash-link" aria-label="Direct link to 1. 复制配置文件" title="Direct link to 1. 复制配置文件">​</a></h4>
<p>将/kernel/arc/arm/configs里面的imx_v7_mfg_defconfig复制一份并命名，我这里命名为imx_keys_emmc_defconfig</p>
<h4 class="anchor anchorWithStickyNavbar_WC8U" id="2-添加相应的设备树文件">2. 添加相应的设备树文件<a href="#2-添加相应的设备树文件" class="hash-link" aria-label="Direct link to 2. 添加相应的设备树文件" title="Direct link to 2. 添加相应的设备树文件">​</a></h4>
<ol>
<li>
<p>在arch/arm/boot/dts下复制一份imx6ull-14x14-evk.dts，重命名，我这里改为imx6ull-keys-emmc.dts,后续编译会把dts文件编译成dtb文件</p>
</li>
<li>
<p>修改编译选项，打开dts下面的Makefile,大概400行左右的位置，找到并添加:<br>
<code>imx6ull-keys-emmc.dtb</code><br>
<!-- -->添加后如下 ：<br>
<img decoding="async" loading="lazy" src="/assets/images/20-ca1a1945650f3176b329b36e97f651ee.png" width="605" height="554" class="img_PzW8"></p>
</li>
<li>
<p>重新编译</p>
</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/quadruped-sim/foot_swing_trajectory/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">foot swing trajectory</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Linux/irq/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Linux IRQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_KLHw thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#从零开始编译u-boot与内核" class="table-of-contents__link toc-highlight">从零开始编译u-boot与内核</a></li><li><a href="#u-boot" class="table-of-contents__link toc-highlight">U-Boot</a><ul><li><a href="#nxp-官方u-boot编译" class="table-of-contents__link toc-highlight">NXP 官方u-boot编译</a></li><li><a href="#移植自己的u-boot" class="table-of-contents__link toc-highlight">移植自己的u-boot</a></li><li><a href="#结束-uboot移植" class="table-of-contents__link toc-highlight">结束 uboot移植</a></li></ul></li><li><a href="#kernel" class="table-of-contents__link toc-highlight">kernel</a><ul><li><a href="#nxp-官方kernel编译" class="table-of-contents__link toc-highlight">NXP 官方kernel编译</a></li><li><a href="#配置自己的kernel" class="table-of-contents__link toc-highlight">配置自己的kernel</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Partner Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.yltzdhbc.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item">flame.yu<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_vnGv"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://disnox.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item">苏工<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_vnGv"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Blog</a></li><li class="footer__item"><a href="https://github.com/ljyws" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_vnGv"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>